{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block headerimg %}{{ DEFAULT_HEADER_BG }}{% endblock %}

{% block content %}
<main id="index" class="index container">
    <form class="filter d-flex align-items-center">
        <span style="position: relative; display: inline-block; direction: ltr;">
            <input type="search" v-model="filter" class="form-control" placeholder="Filter by title or tag" autocomplete="off" spellcheck="false" />
        </span>
    </form>
    
    <nav>
        <ul class="double-list">
            <li v-for="item in filteredItems">
                <a :href="item.url">{{ "{{ item.title }}" }}</a>
                <span class="date">{{ "{{ item.date }}" }}</span>
            </li>
        </ul>
    </nav>

    <div class="tags">
        {% for tag, articles in tags %}
            <a href="{{ SITEURL }}/{{ tag.url }}" class="tag">{{ tag }} ({{ articles | length }})</a>
        {% endfor %}
    </div>
</main>
{% endblock %}

{% block end_doc %}
<script>

items = [
    {% for article in articles %}
    { title: "{{ article.title }}", url: "/{{ article.url }}", date: "{{ article.date.strftime('%d.%m.%Y') }}", tags: [{% for tag in article.tags %}"{{ tag }}",{% endfor %}] },
    {% endfor %}
]

function contains(text, filter) {
    return text.toLowerCase().indexOf(filter.toLowerCase()) > -1
}

var index = new Vue({
    el: '#index',
    data: {
        filter: '',
        items: items
    },

    methods: {
        toogle_nav: function(event) {
            this.show = !this.show;
        }
    },

    computed: {
        filteredItems() {
            return this.items.filter(item => {
                searches = [item.title].concat(item.tags);
                query = searches.map(x => contains(x, this.filter));
                return query.some(x => x == true);
            })
        }
    }
})

</script>

{% endblock %}
